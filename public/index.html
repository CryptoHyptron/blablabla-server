<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Blablabla Chat</title>
  <link rel="manifest" href="manifest.json" />
</head>
<body style="background:#111;color:#fff;font-family:sans-serif;">
  <h1>Blablabla Chat</h1>
  <div id="chat" style="height:60vh;overflow-y:auto;padding:10px;border:1px solid #444;"></div>
  <textarea id="msg-input" placeholder="Napisz wiadomość..." rows="2" style="width:70%"></textarea>
  <button onclick="send()" style="width:25%">Wyślij</button>
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <script>
    const socket = io();
    const chat = document.getElementById("chat");
    const input = document.getElementById("msg-input");
    const number = localStorage.getItem("userNumber") || Math.floor(Math.random()*1000);
    localStorage.setItem("userNumber", number);

    function append(msg) {
      const div = document.createElement("div");
      div.innerText = msg;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function send() {
      const txt = input.value.trim();
      if (txt) {
        socket.emit("chat message", `${number}: ${txt}`);
        input.value = "";
      }
    }

    socket.on("chat message", msg => append(msg));

    input.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });
  </script>
</body>
</html>